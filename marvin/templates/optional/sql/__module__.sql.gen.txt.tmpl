{{ $table_name 	    := ConvertToLowercasePlural .Modules.Name       -}}
{{ $uppercase_module_name := ConvertToLowercaseTitle .Modules.Name  -}}
{{ $lwc_name 	      := ConvertToLowercase .Modules.Name             -}}
{{ $id 			        := printf "%s%s" $lwc_name "_id"                -}}
{{ $endpoints       := .Modules.Endpoints                           -}}
-- Code generated by gomarvin, {{ ConvertLastCharTo .ProjectInfo.GomarvinVersion "x"}}

CREATE TABLE IF NOT EXISTS {{ $table_name }} (
  -- init
  {{ $id }}     uuid              DEFAULT uuid_generate_v4 () PRIMARY KEY,
  created_at    TIMESTAMP         NOT NULL DEFAULT NOW(),
  updated_at    TIMESTAMP         NOT NULL DEFAULT NOW(),

  -- new columns below
  change_me     VARCHAR(300)      NOT NULL
);



-- when the row is updated, update the "updated_at" timestamp
CREATE TRIGGER set_timestamp
BEFORE UPDATE ON {{ $table_name }}
FOR EACH ROW EXECUTE PROCEDURE trigger_set_timestamp();


-- name: {{ $uppercase_module_name }}_one__CountAll :one
SELECT      COUNT(*)
FROM        {{ $table_name }};


-- name: {{ $uppercase_module_name }}_one__CountAllWhereChange_MeIncludes :one
SELECT      COUNT(*)
FROM        {{ $table_name }}
WHERE       change_me ILIKE '%' || ( $1 ) || '%';


-- name: {{ $uppercase_module_name }}_many__GetAllOrderByCreatedAtDesc :many
SELECT      {{ $id }}, created_at
FROM        {{ $table_name }}
ORDER BY    created_at DESC;


-- name: {{ $uppercase_module_name }}_many__GetAllWhereCreatedAtOrderByCreatedAtDesc :many
SELECT      {{ $id }}, created_at
FROM        {{ $table_name }}
WHERE       created_at = $1
ORDER BY    created_at DESC;


-- name: {{ $uppercase_module_name }}_many__GetAllBetweenDatesOrderByCreatedAtDesc :many
SELECT      {{ $id }}, created_at
FROM        {{ $table_name }}
WHERE       created_at BETWEEN SYMMETRIC $1 AND $2
ORDER BY    created_at DESC;


-- name: {{ $uppercase_module_name }}_many__GetWhereChange_MeIncludesOrderByCreatedAtDesc :many
SELECT      {{ $id }}, created_at
FROM        {{ $table_name }}
WHERE       change_me ILIKE '%' || ( $1 ) || '%'
ORDER BY    created_at DESC;


-- name: {{ $uppercase_module_name }}_one__GetWhereId :one
SELECT      {{ $id }}, created_at
FROM        {{ $table_name }}
WHERE       {{ $id }} = $1
LIMIT 1;


-- name: {{ $uppercase_module_name }}_one__Create :one
INSERT INTO {{ $table_name }} ( change_me )
VALUES      ( $1 )
RETURNING   *;


-- name: {{ $uppercase_module_name }}_one__UpdateChange_MeWhereId :one
UPDATE      {{ $table_name }}
SET         change_me = $1
WHERE       {{ $id }} = $2
RETURNING   *;


-- name: {{ $uppercase_module_name }}_one__DeleteWhereId :one
DELETE FROM {{ $table_name }}
WHERE       {{ $id }} = $1
RETURNING   *;
