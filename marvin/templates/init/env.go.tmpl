{{ $project_name    := .ProjectInfo.Name -}}

package settings

import (
	"fmt"
	"os"

    "{{$project_name}}/pkg/convert"
	"github.com/joho/godotenv"
)

// env config file struct
type EnvConfig struct {
	Backend
	Database
}

// env backend settings
type Backend struct {
	FrontendURL string
	HostURL     string
	Port        int
	APIPath     string
	DebugMode   bool
}

// env database settings
type Database struct {
	Host     string
	User     string
	Pass     string
	Name     string
	SSL      string
	Timezone string
	Port     int
}


// NewEnvConfig loads the .env file with the specified path, and
// retuns the EnvConfig struct with the loaded values.
func NewEnvConfig(env_path string) (*EnvConfig, error) {
	if err := godotenv.Load(env_path); err != nil {
		return nil, fmt.Errorf("error loading .env file, %v", err)
	}

	backend_port, err := convert.StringToInt(os.Getenv("GO_BACKEND_PORT"))
	if err != nil {
		return nil, err
	}

	debug_mode, err := convert.StringToBool(os.Getenv("DEBUG_MODE"))
	if err != nil {
		return nil, err
	}

	db_port, err := convert.StringToInt(os.Getenv("DB_PORT"))
	if err != nil {
		return nil, err
	}

	env := EnvConfig{
		Backend{
			FrontendURL: os.Getenv("FRONTEND_URL"),
			HostURL:     os.Getenv("HOST_URL"),
			Port:        backend_port,
			APIPath:     os.Getenv("API_PATH"),
			DebugMode:   debug_mode,
		},
		Database{
			Host:     os.Getenv("DB_HOST"),
			User:     os.Getenv("DB_USER"),
			Pass:     os.Getenv("DB_PASS"),
			Name:     os.Getenv("DB_NAME"),
			SSL:      os.Getenv("DB_SSL"),
			Timezone: os.Getenv("DB_TZ"),
			Port:     db_port,
		},
	}

	return &env, nil
}
